# Telegram Bot - AI + Taklif Checker

یک بات تلگرام با دو قابلیت اصلی:

## 🤖 AI Assistant
پاسخگویی هوشمند در تاپیک خاص چنل با استفاده از Google Gemini

## 📚 Taklif Checker
چک خودکار و ارسال تکالیف مدرسه به تاپیک مشخص

---

## نصب و راه‌اندازی

### 1. نصب وابستگی‌ها

```bash
npm install
```

### 2. تنظیمات

فایل `.env` شامل تنظیمات زیر است:

- `TELEGRAM_BOT_TOKEN`: توکن بات تلگرام شما
- `GOOGLE_API_KEY`: کلید API از Google AI Studio
- `CHANNEL_ID`: شناسه چنل AI Bot (-1003221138302)
- `TOPIC_ID`: شناسه تاپیک AI Bot (620)

### 3. اجرای بات

```bash
npm start
```

یا:

```bash
node ai.js
```

---

## ویژگی‌های AI Bot

- ✅ پاسخ فقط در تاپیک مشخص شده
- ✅ استفاده از Google Gemini 2.5 Flash
- ✅ ذخیره تاریخچه مکالمه برای هر کاربر
- ✅ سیستم صف و Rate Limiting (20 درخواست در دقیقه)
- ✅ نمایش "typing..." هنگام پردازش
- ✅ سرور Express برای health check
- ✅ مدیریت خطا و لاگ‌گذاری

## ویژگی‌های Taklif Bot

- ✅ آپدیت روزانه ساعت 3 ظهر (15:00)
- ✅ ارسال در تاپیک خاص چنل (Topic ID: 22)
- ✅ پاک کردن پیام‌های قبلی قبل از ارسال جدید
- ✅ کامند `/taklif` برای دریافت دستی تکالیف
- ✅ نمایش زمان باقیمانده تا مهلت تحویل
- ✅ تبدیل تاریخ میلادی به شمسی
- ✅ ذخیره شناسه پیام‌ها برای حذف در آپدیت بعدی

---

## استفاده از Taklif Bot

### دریافت خودکار
بات به صورت خودکار **هر روز ساعت 3 ظهر (15:00)** تکالیف را چک کرده و در تاپیک 22 چنل `-1003221138302` ارسال می‌کند. قبل از ارسال، تمام پیام‌های قبلی را پاک می‌کند.

### دریافت دستی با کامند `/taklif`
در هر چت، گروه یا چنلی که بات را اضافه کرده‌اید، دستور `/taklif` را بفرستید. بات تمام تکالیف فعلی را **در همان مکان** برای شما ارسال می‌کند.

---

## نکات مهم

1. بات باید در چنل به عنوان Admin اضافه شود (با دسترسی حذف پیام)
2. AI Bot فقط به پیام‌های تاپیک مشخص شده پاسخ می‌دهد
3. Taklif Bot تکالیف را فقط در تاپیک 22 چنل `-1003221138302` ارسال می‌کند
4. آپدیت روزانه ساعت 3 ظهر (15:00) انجام می‌شود
5. پیام‌های قبلی قبل از هر آپدیت پاک می‌شوند
6. شناسه پیام‌ها در فایل `sent_taklif.json` ذخیره می‌شود
7. سرور Express روی پورت 3000 اجرا می‌شود (قابل تغییر در .env)

## دسترسی به تلگرام در ایران

چون تلگرام در ایران فیلتر است:

1. VPN خود را روشن کنید
2. بات را اجرا کنید: `npm start` یا `node .`

## API Endpoints

- `GET /` - وضعیت AI Bot و اطلاعات پیکربندی
- `GET /test-api` - تست Google Gemini API

---

## ساختار فایل‌ها

```
├── ai.js             # بات اصلی (AI + Taklif)
├── package.json      # وابستگی‌ها و اسکریپت‌ها
├── .env              # تنظیمات محیطی
└── sent_taklif.json  # تاریخچه تکالیف ارسال شده (خودکار ایجاد می‌شود)
```
