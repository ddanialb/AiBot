# Telegram Bots - AI + Taklif Checker

این پروژه شامل دو بات تلگرام است:

## 🤖 AI Bot (ai.js)
بات هوش مصنوعی که در تاپیک خاص چنل پاسخ می‌دهد و از Google Gemini استفاده می‌کند.

## 📚 Taklif Bot (taklif.js)
بات چک کننده تکالیف که به صورت خودکار تکالیف جدید را از سایت مدرسه دریافت و به چنل ارسال می‌کند.

---

## نصب و راه‌اندازی

### 1. نصب وابستگی‌ها

```bash
npm install
```

### 2. تنظیمات

فایل `.env` شامل تنظیمات زیر است:

- `TELEGRAM_BOT_TOKEN`: توکن بات تلگرام شما
- `GOOGLE_API_KEY`: کلید API از Google AI Studio
- `CHANNEL_ID`: شناسه چنل AI Bot (-1003221138302)
- `TOPIC_ID`: شناسه تاپیک AI Bot (620)

### 3. اجرای بات‌ها

#### اجرای هر دو بات با هم:
```bash
npm start
```
یا:
```bash
node .
```

#### اجرای جداگانه:
```bash
npm run ai        # فقط AI Bot
npm run taklif    # فقط Taklif Bot
```

---

## ویژگی‌های AI Bot

- ✅ پاسخ فقط در تاپیک مشخص شده
- ✅ استفاده از Google Gemini 2.5 Flash
- ✅ ذخیره تاریخچه مکالمه برای هر کاربر
- ✅ سیستم صف و Rate Limiting (20 درخواست در دقیقه)
- ✅ نمایش "typing..." هنگام پردازش
- ✅ سرور Express برای health check
- ✅ مدیریت خطا و لاگ‌گذاری

## ویژگی‌های Taklif Bot

- ✅ چک خودکار تکالیف هر 2 ساعت
- ✅ ارسال فقط تکالیف جدید به چنل
- ✅ ذخیره تکالیف ارسال شده برای جلوگیری از تکرار
- ✅ کامند `/taklif` برای دریافت دستی تکالیف
- ✅ نمایش زمان باقیمانده تا مهلت تحویل
- ✅ تبدیل تاریخ میلادی به شمسی
- ✅ پاکسازی خودکار تکالیف قدیمی

---

## استفاده از Taklif Bot

### دریافت خودکار
بات به صورت خودکار هر 2 ساعت تکالیف جدید را چک کرده و به چنل `-1003221138302` ارسال می‌کند.

### دریافت دستی
در هر چت یا چنلی که بات را اضافه کرده‌اید، دستور زیر را بفرستید:

```
/taklif
```

بات تمام تکالیف فعلی را برای شما ارسال می‌کند.

---

## نکات مهم

1. بات باید در چنل به عنوان Admin اضافه شود
2. AI Bot فقط به پیام‌های تاپیک مشخص شده پاسخ می‌دهد
3. Taklif Bot تکالیف را فقط در چنل `-1003221138302` ارسال می‌کند
4. تاریخچه تکالیف ارسال شده در فایل `sent_taklif.json` ذخیره می‌شود
5. سرور Express روی پورت 3000 اجرا می‌شود (قابل تغییر در .env)

## دسترسی به تلگرام در ایران

چون تلگرام در ایران فیلتر است:

1. VPN خود را روشن کنید
2. بات را اجرا کنید: `npm start` یا `node .`

## API Endpoints

- `GET /` - وضعیت AI Bot و اطلاعات پیکربندی
- `GET /test-api` - تست Google Gemini API

---

## ساختار فایل‌ها

```
├── index.js          # فایل اصلی که هر دو بات را اجرا می‌کند
├── ai.js             # بات هوش مصنوعی (قبلا server.js)
├── taklif.js         # بات چک کننده تکالیف (قبلا bot.js)
├── package.json      # وابستگی‌ها و اسکریپت‌ها
├── .env              # تنظیمات محیطی
└── sent_taklif.json  # تاریخچه تکالیف ارسال شده (خودکار ایجاد می‌شود)
```
